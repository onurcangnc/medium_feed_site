<!DOCTYPE html>
<html lang="en" class="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>{{ site_title }}</title>
  <link rel="icon" type="image/png" href="/static/profile.jpg">
  <link href="/static/output.css" rel="stylesheet" />
  <script src="https://unpkg.com/scrollreveal"></script>
</head>
<body class="bg-white text-gray-900 dark:bg-gray-950 dark:text-white font-sans">

  <!-- Navbar -->
  <nav class="sticky top-0 z-50 bg-white dark:bg-gray-900 border-b dark:border-gray-800 shadow-sm">
    <div class="max-w-7xl mx-auto px-4 py-3 flex justify-between items-center">
      <h1 class="text-xl font-bold text-blue-500 dark:text-blue-400">{{ site_title }}</h1>
      <button onclick="toggleTheme()" class="ml-auto text-sm bg-gray-200 dark:bg-gray-700 px-3 py-1 rounded hover:bg-gray-300 dark:hover:bg-gray-600 focus:outline-none">
        Toggle Theme
      </button>
    </div>
  </nav>

  <main class="max-w-7xl mx-auto px-4 py-10">
    
    <!-- Dropdown Tag Filter -->
    <div class="flex justify-center mb-8">
      <select 
        onchange="filterPosts(this.value)" 
        class="px-4 py-2 rounded bg-gray-100 dark:bg-gray-800 text-gray-900 dark:text-white border dark:border-gray-600"
      >
        <option value="all">Show All Tags</option>
        {% set all_tags = posts | map(attribute='tags') | sum(start=[]) | unique %}
        {% for tag in all_tags %}
        <option value="{{ tag }}">{{ tag }}</option>
        {% endfor %}
      </select>
    </div>

    <!-- Posts Grid -->
    <div id="postsContainer" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
      {% for post in posts %}
      <div 
        class="post-card bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-900 rounded-xl overflow-hidden shadow-md hover:shadow-xl transition-transform transform hover:-translate-y-1" 
        data-sr 
        data-tags="{{ post.tags | join(',') }}"
      >
        {% if post.thumbnail %}
        <img src="{{ post.thumbnail }}" alt="{{ post.title }}" class="w-full h-48 object-cover">
        {% endif %}
        <div class="p-5">
          <div class="text-xs text-gray-500 dark:text-gray-400 mb-1">{{ post.published }}</div>
          <h2 class="text-lg font-semibold mb-2">{{ post.title }}</h2>
          <p class="text-sm text-gray-700 dark:text-gray-300 line-clamp-3 mb-4">
            {{ post.summary | truncate(160, True, "...") }}
          </p>
          <a href="{{ post.link }}" target="_blank">
            <button class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-full transition text-sm">
              Read Article â†’
            </button>
          </a>
        </div>
      </div>
      {% endfor %}
    </div>

    <!-- Pagination -->
    {% if total_pages > 1 %}
    <div class="mt-10 text-center space-x-2">
      {% for page_num in range(1, total_pages + 1) %}
        {% if page_num == current_page %}
          <span class="px-4 py-2 rounded bg-blue-600 text-white font-semibold">{{ page_num }}</span>
        {% else %}
          <a href="{% if page_num == 1 %}/index.html{% else %}/page/{{ page_num }}.html{% endif %}" class="px-4 py-2 rounded bg-gray-300 dark:bg-gray-600 hover:bg-gray-400 dark:hover:bg-gray-500 text-black dark:text-white font-semibold">
            {{ page_num }}
          </a>
        {% endif %}
      {% endfor %}
    </div>
    {% endif %}
  </main>

  <!-- JavaScript -->
  <script>
    if (localStorage.getItem('theme') === 'light') {
      document.documentElement.classList.remove('dark');
    } else {
      document.documentElement.classList.add('dark'); // default to dark
    }

    function toggleTheme() {
      const html = document.documentElement;
      const isDark = html.classList.contains('dark');
      if (isDark) {
        html.classList.remove('dark');
        localStorage.setItem('theme', 'light');
      } else {
        html.classList.add('dark');
        localStorage.setItem('theme', 'dark');
      }
    }

    function filterPosts(tag) {
      document.querySelectorAll('.post-card').forEach(card => {
        const tags = card.dataset.tags.toLowerCase();
        card.style.display = tag === 'all' || tags.includes(tag.toLowerCase()) ? 'block' : 'none';
      });
    }

    ScrollReveal().reveal('[data-sr]', {
      distance: '30px',
      origin: 'bottom',
      opacity: 0,
      duration: 800,
      interval: 100,
      reset: false
    });
  </script>
</body>
</html>
